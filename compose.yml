services:
  # Database
  postgres:
    image: postgres
    environment:
      - POSTGRES_USER=organaizer
      - POSTGRES_PASSWORD=organaizer
      - POSTGRES_DB=organaizer
    volumes:
      - ./.data/postgres:/var/lib/postgresql/data
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    logging:
      driver: none
    ports:
      - "5432:5432"
  # Database Browser
  pgadmin:
    image: dpage/pgadmin4:latest
    restart: unless-stopped
    user: root
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@organaizer.com
      PGADMIN_DEFAULT_PASSWORD: admin
    logging:
      driver: none
    volumes:
      - ./.data/pgadmin/:/var/lib/pgadmin/
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    ports:
      - "8080:80"
  app:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8888:8888"
    devices:
      # video devices may need to be updated
      - /dev/video0:/dev/video0
      - /dev/video1:/dev/video1
      - /dev/video2:/dev/video2
      - /dev/video3:/dev/video3
      - /dev/video4:/dev/video4
      - /dev/video5:/dev/video5
      - /dev/video6:/dev/video6
      - /dev/video7:/dev/video7
      - /dev/bus/usb:/dev/bus/usb
    volumes:
      - ./src:/app
      - /tmp/.X11-unix:/tmp/.X11-unix
    privileged: true
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - DISPLAY=${DISPLAY}
      - UDEV=1
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]